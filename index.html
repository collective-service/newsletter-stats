<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.11/c3.min.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.11/c3.min.js"></script>
    <link href='styles.css' rel='stylesheet' />
</head>

<body>
    <div class="container">
      <!-- Initialize a select button -->
      <div id="chart"></div>
    </div>
    <script type="text/javascript">
        const dataURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSzFMVyQqV0bn9GfOp5vUjcGf6DzyMUUwE446kFMvwlK7PYaOMHOe5Pqhd8-i6J7Q/pub?gid=1331125921&single=true&output=csv";
        $(document).ready(function() {
            function sortID(a, b) {
                if (a["ID"] > b["ID"]) {
                    return 1;
                }
                if (a["ID"] < b["ID"]) {
                    return -1;
                }
                return 0;
            }

            d3.csv(dataURL).then(function(dt) {
                var data = dt.filter(d => {
                    return d["ID"] != '';
                });
                data.forEach(element => {
                    const mm = moment(element["Date"], "DD/MM/YYYY");
                    var date = new Date(mm.year(), mm.month(), mm.date());
                    element["Date"] = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
                    element["Open Rate"] = +element["Open Rate"];
                    element["Click Rate"] = +element["Click Rate"];
                    element["Members"] = +element["Members"];
                });
                data = data.sort(sortID);
                var xArr = ['x'],
                    openArr = ['Open Rate'];
                    clickArr = ['Click Rate'];
                    memberArr = ['Members'];
                data.forEach(d => {
                    if (d["Date"] != 'NaN-NaN-NaN') {
                        xArr.push(d["Date"]);
                        openArr.push(d["Open Rate"]);
                        clickArr.push(d["Click Rate"]);
                        memberArr.push(d["Members"]);
                    }
                });

                var chart = c3.generate({
                    bind: "#chart",
                    data: {
                        x: 'x',
                        columns: [xArr, openArr, clickArr, memberArr]
                    },
                    color: {
                        pattern: ['#204669', '#D90368', '#D2D2D2']
                    },
                    axis: {
                        x: {
                            type: 'timeseries',
                            tick: {
                                centered: true,
                                outer: true,
                                fit: true,
                                format: '%m %Y'
                            }
                        },
                        y: {
                            show: true,
                            // min: 22,
                            min: 8,
                            max: 92,
                            tick: {
                                centered: true,
                                outer: true,
                                fit: true,
                                count:5,
                                format: d3.format('d')
                            }
                        },

                    },
                    grid: {
                        y: {
                            show: true
                        }
                    },
                    size: {
                        height: 300,
                        width: 480
                    },
                    padding: {
                        // left: 20,
                        top:30,
                        right:30,
                    },
                    legend: {
                        hide: false
                    },
                    tooltip: {
                        format: {
                            value: function(value, ratio, id) {
                              var label= value;
                              if (id !="Members") label=value + "%" ;
                              return label
                            }
                        }
                    }
                });

            })
        });
    </script>
</body>

</html>
